<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather App</title>
            <style>
                *{
                    zoom: 105%;
                }
        body {
            font-family: SansSerif, Arial, sans-serif;
            background-color: #f5f5ff;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
        }

        #thebigone h2 {
            margin-top: 40px;
            font-family: sans-serif;
            color: #4a76c3;
            text-align: center;
            font-size: 150%;
        }

        #frame {
            width: 500px;
            height: 750px;
            margin-top: 40px;
            border: 1px solid #ccc;
            background-color: #f5f5ff;
        }

        #panel {
            display: flex;
            flex-direction: column;
            padding: 20px;
            padding-bottom: 400px;
            height: 100%;
            box-sizing: border-box;
        }

        #label {
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            margin-bottom: 10px;
        }
        #textfield {
            height: 30px;
            font-size: 14px;
            margin-bottom: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        #enter {
            font-weight: bold;
            font-size: 14px;
            background-color: #6495ed;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            margin-bottom: 10px;
            align-self: center;
        }
        #weatherPanel {
            background-color: #e6f0ff;
            padding: 10px 20px 20px 20px;
            border-radius: 5px;
            margin-top: 10px;
            flex-grow: 1;
            font-size: 14px;
            height:160%;
        }
        #weatherPanel img{
            margin-left:170px;
            margin-top:-140px;
        }
        #weatherPanel h2{
            margin-top: 0px;
            font-family: sans-serif;
            color: #000000;
            text-align: left;
            font-size: 150%;
        }
    </style>
</head>
<body>
    <div id="thebigone">
    <h2> weather app - science fair!</h2>
    <div id="frame">
        <div id="panel">
            <label id="label">pick a city!</label>
            <input type="text" id="textfield" maxlength="20">
            <button id="enter">Enter</button>
            <div id="weatherPanel">
            </div>
        </div>
    </div>
    </div>

    <script>
        document.getElementById('enter').addEventListener('click', async () => {
    const location = document.getElementById('textfield').value.trim();
    if (location.toLowerCase() === "no") {
        window.close();
        return;
    }

    const locData = await getLocationData(location);
    if (!locData) {
        alert("Location not found.");
        return;
    }

    const latitude = locData.lat;
    const longitude = locData.lon;

    try {
        const apiKey = "dc5b3d498315078db350ba01d461365b";
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric`;

        const response = await fetch(url);
        if (!response.ok) {
            console.log("Error: Could not connect to OpenWeatherMap API");
            return;
        }

        const json = await response.json();
        const weather = json.weather[0];
        const main = json.main;
        const wind = json.wind;
        const time = new Date(json.dt * 1000).toISOString();
        const temperature = main.temp;
        const windSpeed = wind.speed;
        const precip = json.rain ? json.rain["1h"] || 0 : 0;
        const ameriPrecip = (precip / 25.4).toFixed(2);
        const americanTemp = ((temperature * 1.8) + 32).toFixed(2);
        const americanMile = (windSpeed / 1.609).toFixed(2);

        let swimCond = "";
        function checkSwim(precip, temperature) {
            return (precip > 10 || temperature < 25) ? " not" : " ";
        }

        swimCond = checkSwim(precip, temperature);

        const myImage = new Image(150, 150);
        myImage.src = "erjgheruigrtuihgrt.png";

        const weatherInfo = `
            <b>Weather Info:</b><br>
            Date: ${time.slice(0,10)}<br>
            Time: ${time.slice(11,16)}<br>
            Temperature (C): ${temperature} °C<br>
            Temperature (F): ${americanTemp} °F<br>
            Wind Speed (Kilometers): ${windSpeed} km/h<br>
            Wind Speed (Miles): ${americanMile} Mph<br>
            Precipitation (mm): ${precip} mm<br>
            Precipitation (inches): ${ameriPrecip} in
            <br><br>
            <h2>Right now is${swimCond} a good time to go swimming in ${location}</h2>
        `;

        const weatherPanel = document.getElementById('weatherPanel');
        weatherPanel.innerHTML = weatherInfo;

        const isDay = json.sys.sunrise < json.dt && json.dt < json.sys.sunset;

        if (isDay && precip < 10 && temperature > 22) {
            weatherPanel.appendChild(myImage);
        } else if (!isDay) {
            const Bird = new Image(150, 150);
            Bird.src = "sleepybird.png";
            weatherPanel.appendChild(Bird);
        } else if (isDay && temperature < 22) {
            const Bird = new Image(150, 150);
            Bird.src = "frozenbird.png";
            weatherPanel.appendChild(Bird);
        }

    } catch (err) {
        console.error(err);
    }
});

async function getLocationData(location) {
    const apiKey = "dc5b3d498315078db350ba01d461365b";
    const formattedLocation = location.replaceAll(" ", "+");
    const url = `https://api.openweathermap.org/geo/1.0/direct?q=${formattedLocation}&limit=1&appid=${apiKey}`;

    try {
        const response = await fetch(url);
        if (!response.ok) {
            console.log("Error: Location API failed");
            return null;
        }
        const json = await response.json();
        return json[0];
    } catch (err) {
        console.error(err);
        return null;
    }
}

    </script>
</body>
</html>
